<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questio | 20ë…„ ë² í…Œë‘ê³¼ AIê°€ ë§Œë“œëŠ” ì•½ìˆ í˜• ë…¼ìˆ ì˜ ë‹µ</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Outfit:wght@700&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradient-bg {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .hero-gradient {
            background: linear-gradient(-45deg, #1e1b4b, #312e81, #4c1d95, #1e1b4b);
            background-size: 400% 400%;
            animation: gradient-bg 15s ease infinite;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            border-color: #8b5cf6;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.2);
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(139, 92, 246, 0.8);
        }
    </style>
</head>

<body class="bg-[#0a0a0c] text-gray-200 font-['Noto_Sans_KR'] overflow-x-hidden">

    <nav class="fixed w-full z-50 px-6 py-4 bg-black/50 backdrop-blur-md">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-2xl font-['Outfit'] font-bold text-white tracking-tighter">
                QUEST<span class="text-purple-500">IO</span>
            </div>
            <div class="hidden md:flex gap-8 text-sm font-medium">
                <a href="#expert" class="hover:text-purple-400 transition">20ë…„ì˜ ë‚´ê³µ</a>
                <a href="#ai" class="hover:text-purple-400 transition">AI í•œë°•ì‚¬</a>
                <a href="#pricing" class="hover:text-purple-400 transition">ìš”ê¸ˆ ì•ˆë‚´</a>
            </div>
            <a href="https://pf.kakao.com/_hanbaksa-TEST_/chat" target="_blank"
                class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2 rounded-full text-sm font-bold transition">
                1:1 ìƒë‹´
            </a>
        </div>
    </nav>

    <section class="relative min-h-screen flex items-center justify-center hero-gradient px-6 pt-20">
        <div class="container mx-auto text-center">
            <div
                class="inline-block px-4 py-1.5 mb-6 rounded-full border border-purple-500/30 bg-purple-500/10 text-purple-400 text-sm font-bold tracking-wide animate-pulse">
                3-6ë“±ê¸‰ ì¤‘ìœ„ê¶Œ í•™ìƒì„ ìœ„í•œ ì—­ì „ ì‹œë‚˜ë¦¬ì˜¤
            </div>
            <h1 class="text-5xl md:text-7xl font-bold text-white mb-6 leading-tight">
                20ë…„ ë…¼ìˆ  ê¶Œìœ„ìì™€<br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500 neon-text">AI
                    í•œë°•ì‚¬ê°€ ë§Œë‚¬ìŠµë‹ˆë‹¤</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto mb-10 leading-relaxed">
                ë‹¨ìˆœí•œ ì½”ë”©ì´ ì•„ë‹™ë‹ˆë‹¤. 20ë…„ê°„ ìˆ˜ë¦¬ë…¼ìˆ  í˜„ì¥ì—ì„œ ìˆ˜ë§Œ ëª…ì„ í•©ê²©ì‹œí‚¨ WonerìŒ¤ì˜ ë°ì´í„°ê°€ ê³ ìŠ¤ë€íˆ ë‹´ê¸´ AI ì²¨ì‚­, ì˜¤ì§ Questioì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </p>
            <div class="flex flex-col md:flex-row justify-center gap-4">
                <button onclick="openGradingModal()"
                    class="bg-white text-black px-10 py-4 rounded-xl font-bold text-lg hover:bg-purple-500 hover:text-white transition-all">
                    ì§€ê¸ˆ ë¬´ë£Œ ì²´í—˜ ì‹œì‘í•˜ê¸°
                </button>
            </div>
        </div>
    </section>

    <section id="expert" class="py-24 bg-[#0d0d11]">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-2 gap-16 items-center">
                <div class="relative">
                    <div class="absolute -inset-4 bg-purple-500/20 blur-3xl rounded-full"></div>
                    <img src="https://images.unsplash.com/photo-1524178232363-1fb28f74b0cd?auto=format&fit=crop&w=800&q=80"
                        alt="Education Expert" class="relative rounded-2xl shadow-2xl border border-white/10">
                    <div class="absolute -bottom-6 -right-6 glass-card p-6 rounded-xl">
                        <p class="text-purple-400 font-bold text-4xl mb-1">20Y+</p>
                        <p class="text-sm text-gray-400">University Essay Coaching</p>
                    </div>
                </div>
                <div>
                    <h2 class="text-4xl font-bold text-white mb-8">ê¸°ìˆ ì€ í‰ë‚´ ë‚¼ ìˆ˜ ìˆì–´ë„,<br><span class="text-purple-500">20ë…„ì˜
                            ì§ê´€</span>ì€ ë”°ë¼ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h2>
                    <p class="text-gray-400 text-lg leading-relaxed mb-6">
                        ì €ëŠ” ì§€ë‚œ 20ë…„ê°„ ëŒ€í•™ë³„ ìˆ˜ë¦¬ë…¼ìˆ  ê³ ì‚¬ë¥¼ ì§€ë„í•˜ë©°, 3-6ë“±ê¸‰ í•™ìƒë“¤ì´ ì–´ë””ì„œ ë§‰íˆê³  ì–´ë–»ê²Œ ì„œìˆ í•´ì•¼ í•©ê²©í•˜ëŠ”ì§€ í˜„ì¥ì—ì„œ ì§ì ‘ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
                    </p>
                    <p class="text-gray-400 text-lg leading-relaxed mb-8">
                        <strong>Questio</strong>ëŠ” ê·¸ ë°©ëŒ€í•œ 'í•©ê²© ë‹µì•ˆì˜ ë²•ì¹™'ì„ AIì— ì´ì‹í•œ ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤. ê°€ì²œëŒ€ë¶€í„° ê³ ë ¤ëŒ€(ì„¸ì¢…)ê¹Œì§€, 15ê°œ ëŒ€í•™ ì•½ìˆ í˜• ë…¼ìˆ ì˜ ì¶œì œ
                        ê²½í–¥ì„ ë°ì´í„°ë¡œ ì •êµí•˜ê²Œ ë¶„ì„í•©ë‹ˆë‹¤.
                    </p>
                    <ul class="space-y-4">
                        <li class="flex items-center gap-3 text-white font-medium">
                            <span class="text-purple-500">âœ”</span> ëŒ€í•™ë³„ ë°°ì  ê¸°ì¤€ ì™„ë²½ ë°˜ì˜
                        </li>
                        <li class="flex items-center gap-3 text-white font-medium">
                            <span class="text-purple-500">âœ”</span> ê°œì¸ë³„ ì·¨ì•½ ë‹¨ì› 'ì„±ì¥ ì§€í‘œ' ì œê³µ
                        </li>
                        <li class="flex items-center gap-3 text-white font-medium">
                            <span class="text-purple-500">âœ”</span> êµ­ì–´Â·ìˆ˜í•™ í†µí•© ì•½ìˆ í˜• ì „ëµ ìˆ˜ë¦½
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="ai" class="py-24 relative overflow-hidden">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold text-white mb-16">AI í•œë°•ì‚¬ê°€ ì œê³µí•˜ëŠ”<br>ì´ˆì •ë°€ í”¼ë“œë°±</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="glass-card p-10 rounded-3xl">
                    <div class="w-16 h-16 bg-purple-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <span class="text-3xl">ğŸ¯</span>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-4">1ì´ˆ ìë™ ì²¨ì‚­</h3>
                    <p class="text-gray-400">ì œì¶œ ì¦‰ì‹œ AIê°€ ì„œìˆ ì˜ ëª…ë£Œì„±ê³¼ ì •í™•ì„±ì„ ì§„ë‹¨í•˜ì—¬ ë³´ì™„ì ì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
                </div>
                <div class="glass-card p-10 rounded-3xl">
                    <div class="w-16 h-16 bg-pink-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <span class="text-3xl">ğŸ“Š</span>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-4">ì„±ì¥ ë¦¬í¬íŠ¸</h3>
                    <p class="text-gray-400">í•™ìƒì˜ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì„ ë°ì´í„°í™”í•˜ì—¬ ì·¨ì•½ ìœ í˜•ì„ ì§‘ì¤‘ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="glass-card p-10 rounded-3xl">
                    <div class="w-16 h-16 bg-blue-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <span class="text-3xl">ğŸ“±</span>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-4">24/7 í•™ìŠµ íŒŒíŠ¸ë„ˆ</h3>
                    <p class="text-gray-400">ì‹œê°„ê³¼ ì¥ì†Œì˜ ì œì•½ ì—†ì´ ì–¸ì œ ì–´ë””ì„œë“  ì–‘ì§ˆì˜ ë…¼ìˆ  ì§€ë„ë¥¼ ë°›ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="process" class="py-24 relative">
        <div class="absolute inset-0 bg-purple-900/10 blur-3xl -z-10"></div>
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <span class="text-purple-500 font-bold tracking-wider text-sm uppercase">Process</span>
                <h2 class="text-4xl font-bold text-white mt-4">í•©ê²©ìœ¼ë¡œ ê°€ëŠ” <br class="md:hidden">3ë‹¨ê³„ ë¡œë“œë§µ</h2>
            </div>

            <div class="grid md:grid-cols-3 gap-8 relative">
                <!-- Line connector for desktop -->
                <div
                    class="hidden md:block absolute top-12 left-0 w-full h-0.5 bg-gradient-to-r from-purple-500/0 via-purple-500/50 to-purple-500/0">
                </div>

                <!-- Step 1 -->
                <div class="relative z-10 text-center group">
                    <div
                        class="w-24 h-24 mx-auto bg-[#0d0d11] border border-purple-500/30 rounded-full flex items-center justify-center mb-6 group-hover:border-purple-500/80 group-hover:shadow-[0_0_30px_rgba(168,85,247,0.4)] transition-all duration-300">
                        <span class="text-xl md:text-4xl">ğŸ“¸</span>
                    </div>
                    <div
                        class="inline-block bg-purple-500/10 text-purple-400 px-3 py-1 rounded-full text-xs font-bold mb-4">
                        STEP 01</div>
                    <h3 class="text-xl font-bold text-white mb-2">ë‹µì•ˆ ì œì¶œ</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        ì‘ì„±í•œ ë‹µì•ˆì„ ì‚¬ì§„ìœ¼ë¡œ ì°ì–´ ì—…ë¡œë“œí•˜ì„¸ìš”.<br>
                        AIê°€ ì´ë¯¸ì§€ë¥¼ í…ìŠ¤íŠ¸ë¡œ ìë™ ë³€í™˜í•©ë‹ˆë‹¤.
                    </p>
                </div>

                <!-- Step 2 -->
                <div class="relative z-10 text-center group">
                    <div
                        class="w-24 h-24 mx-auto bg-[#0d0d11] border border-purple-500/30 rounded-full flex items-center justify-center mb-6 group-hover:border-purple-500/80 group-hover:shadow-[0_0_30px_rgba(168,85,247,0.4)] transition-all duration-300">
                        <span class="text-xl md:text-4xl">âš¡</span>
                    </div>
                    <div
                        class="inline-block bg-purple-500/10 text-purple-400 px-3 py-1 rounded-full text-xs font-bold mb-4">
                        STEP 02</div>
                    <h3 class="text-xl font-bold text-white mb-2">AI ì •ë°€ ì§„ë‹¨</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        ì œì¶œ ì¦‰ì‹œ 1ì´ˆ ë§Œì— ì±„ì ê³¼ ì²¨ì‚­ì´ ì™„ë£Œë©ë‹ˆë‹¤.<br>
                        ëŒ€í•™ë³„ í‰ê°€ ê¸°ì¤€ì— ë§ì¶° ì ìˆ˜ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.
                    </p>
                </div>

                <!-- Step 3 -->
                <div class="relative z-10 text-center group">
                    <div
                        class="w-24 h-24 mx-auto bg-[#0d0d11] border border-purple-500/30 rounded-full flex items-center justify-center mb-6 group-hover:border-purple-500/80 group-hover:shadow-[0_0_30px_rgba(168,85,247,0.4)] transition-all duration-300">
                        <span class="text-xl md:text-4xl">ğŸš€</span>
                    </div>
                    <div
                        class="inline-block bg-purple-500/10 text-purple-400 px-3 py-1 rounded-full text-xs font-bold mb-4">
                        STEP 03</div>
                    <h3 class="text-xl font-bold text-white mb-2">ë§ì¶¤ ì „ëµ ì œì‹œ</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        ì·¨ì•½ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê°œì¸ë³„ í•©ê²© ì „ëµê³¼<br>
                        ë§ì¶¤í˜• ì¶”ê°€ ë¬¸í•­ì„ ì œê³µí•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="pricing" class="py-24 bg-[#0d0d11]">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold text-white text-center mb-16"><span class="text-purple-500">1ì›” í•œì • ë¬´ë£Œ
                    ì²´í—˜</span><br>ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•˜ì„¸ìš”</h2>
            <div class="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                <div class="glass-card p-8 rounded-3xl border border-white/5">
                    <h3 class="text-xl font-bold mb-2">ìŠ¤íƒ ë‹¤ë“œ</h3>
                    <p class="text-gray-500 text-sm mb-6">êµ­ì–´ ë˜ëŠ” ìˆ˜í•™ ì„ íƒí˜•</p>
                    <p class="text-3xl font-bold text-white mb-8">0<span class="text-lg text-gray-500 font-normal"> / 1ì›”
                            í•œì • ë¬´ë£Œ</span></p>
                    <ul class="text-sm text-gray-400 space-y-4 mb-10">
                        <li>â€¢ AI ì²¨ì‚­ ì‹œìŠ¤í…œ ì´ìš©</li>
                        <li>â€¢ ê¸°ë³¸ í•™ìŠµ ë¶„ì„ ë¦¬í¬íŠ¸</li>
                        <li>â€¢ ëŒ€í•™ë³„ ê¸°ì¶œ ë°ì´í„° ì œê³µ</li>
                    </ul>
                    <button onclick="openGradingModal()"
                        class="w-full py-3 rounded-xl border border-white/10 hover:bg-white/5 transition font-bold text-purple-400">ë¬´ë£Œ
                        ì²´í—˜ ì‹œì‘í•˜ê¸°</button>
                </div>
                <div class="glass-card p-8 rounded-3xl border-2 border-purple-500 relative">
                    <div
                        class="absolute -top-4 left-1/2 -translate-x-1/2 bg-purple-500 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-widest">
                        Most Popular</div>
                    <h3 class="text-xl font-bold mb-2">í”„ë¦¬ë¯¸ì—„</h3>
                    <p class="text-gray-500 text-sm mb-6">êµ­ì–´ + ìˆ˜í•™ ì˜¬ì¸ì›</p>
                    <p class="text-3xl font-bold text-white mb-8">0<span class="text-lg text-gray-500 font-normal"> / 1ì›”
                            í•œì • ë¬´ë£Œ</span></p>
                    <ul class="text-sm text-gray-300 space-y-4 mb-10">
                        <li>â€¢ êµ­ì–´/ìˆ˜í•™ ì „ ê³¼ëª© AI ì²¨ì‚­</li>
                        <li>â€¢ ê³ ë‚œë„ ë¬¸í•­ ë¬´ì œí•œ ì œì¶œ</li>
                        <li>â€¢ ì·¨ì•½ì  ì •ë°€ ì§„ë‹¨ ì‹œìŠ¤í…œ</li>
                    </ul>
                    <button onclick="openGradingModal()"
                        class="w-full py-3 rounded-xl bg-purple-600 hover:bg-purple-700 text-white transition font-bold">ë¬´ë£Œ
                        ì²´í—˜ ì‹œì‘í•˜ê¸°</button>
                </div>
                <div class="glass-card p-8 rounded-3xl border border-white/5">
                    <h3 class="text-xl font-bold mb-2">ì—°ê°„ í’€íŒ¨í‚¤ì§€</h3>
                    <p class="text-gray-500 text-sm mb-6">ìˆ˜ëŠ¥ê¹Œì§€ ì™„ë²½ ì§‘ì¤‘</p>
                    <p class="text-3xl font-bold text-white mb-8">149ë§Œ<span class="text-lg text-gray-500 font-normal"> /
                            ì—°</span></p>
                    <ul class="text-sm text-gray-400 space-y-4 mb-10">
                        <li>â€¢ ì „ ê³¼ëª© í”„ë¦¬ë¯¸ì—„ ëª¨ë“  ê¸°ëŠ¥</li>
                        <li>â€¢ ì›” 1íšŒ ëŒ€ì… ì „ëµ ìƒë‹´</li>
                        <li>â€¢ **20% í• ì¸ í˜œíƒ í¬í•¨**</li>
                    </ul>
                    <button
                        class="w-full py-3 rounded-xl border border-white/10 hover:bg-white/5 transition font-bold">ìƒë‹´ í›„
                        ê²°ì œ</button>
                </div>
            </div>
        </div>
    </section>

    <footer class="py-12 border-t border-white/5 px-6">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-gray-500 text-sm">
                Â© 2026 QUESTIO. All rights reserved. <br>
                ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: [ì›ì¥ë‹˜ ë²ˆí˜¸ ì…ë ¥] | ëŒ€í‘œ: [ì›ì¥ë‹˜ ì„±í•¨]
            </div>
            <div class="flex gap-6">
                <a href="#" class="text-gray-400 hover:text-white transition">ì´ìš©ì•½ê´€</a>
                <a href="#" class="text-gray-400 hover:text-white transition">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
            </div>
        </div>
    </footer>

    <div class="fixed bottom-8 right-8 z-50">
        <a href="https://pf.kakao.com/_hanbaksa-TEST_/chat" target="_blank"
            class="flex items-center gap-3 bg-[#FEE500] text-black px-6 py-4 rounded-full font-bold shadow-2xl hover:scale-110 transition-transform">
            <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png"
                class="w-6 h-6">
            ì›ì¥ë‹˜ ì§ì ‘ ìƒë‹´
        </a>
    </div>

    <!-- Admin Node Modal (Replaces Grading Modal) -->
    <div id="gradingModal" class="fixed inset-0 z-[100] hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="closeGradingModal()"></div>

        <!-- Dashboard Content -->
        <div
            class="absolute inset-4 md:inset-10 bg-[#0a0a0c] border border-white/10 rounded-3xl overflow-hidden flex flex-col shadow-2xl">

            <!-- Header -->
            <div class="flex items-center justify-between px-8 py-6 border-b border-white/5 bg-[#13111c]">
                <div>
                    <h1 class="text-3xl font-['Outfit'] font-bold text-white tracking-widest">ADMIN <span
                            class="text-blue-500">NODE</span></h1>
                    <div class="flex items-center gap-2 text-xs text-gray-500 mt-1">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        TIME-SERIES GROWTH MONITOR
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button class="bg-[#1c1a26] border border-white/10 px-4 py-2 rounded-lg text-sm text-gray-300">
                        STANDARD AI (v3.5)
                    </button>
                    <button onclick="closeGradingModal()"
                        class="w-10 h-10 flex items-center justify-center rounded-lg border border-white/10 text-gray-400 hover:text-white hover:bg-white/5 transition">
                        âœ•
                    </button>
                </div>
            </div>

            <!-- Main Body -->
            <div class="flex-1 overflow-y-auto p-8 grid grid-cols-1 lg:grid-cols-12 gap-8 custom-scrollbar">

                <!-- Left Column: Database & Context (7 cols) -->
                <div class="lg:col-span-7 flex flex-col gap-6">

                    <!-- 1. Master Database Sync -->
                    <div class="bg-[#13111c] border border-blue-500/20 rounded-2xl p-6 relative overflow-hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-blue-400 font-bold text-sm tracking-wider">MASTER DATABASE SYNC</h3>
                            <span id="recordCount" class="text-xs text-blue-500 font-mono">0 RECORDS</span>
                        </div>
                        <div class="flex items-center gap-4 bg-[#0a0a0c] border border-white/10 rounded-xl p-2 px-4">
                            <div class="flex-1 truncate text-gray-500 text-sm font-mono" id="syncFileName">No CSV Loaded
                            </div>
                            <input type="file" id="csvInput" accept=".csv" class="hidden"
                                onchange="handleCSVUpload(this)">
                            <button onclick="document.getElementById('csvInput').click()"
                                class="text-xs text-gray-400 hover:text-white uppercase font-bold">File</button>
                            <button onclick="document.getElementById('csvInput').click()"
                                class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold px-4 py-2 rounded-lg transition shadow-[0_0_15px_rgba(59,130,246,0.5)]">SYNC</button>
                        </div>
                    </div>

                    <!-- 2. Filters -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-2 uppercase">University</label>
                            <input type="text" id="filterUniversity" placeholder="ì•„ì£¼ëŒ€í•™êµ"
                                class="w-full bg-[#13111c] border border-white/10 rounded-xl px-4 py-3 text-white focus:border-blue-500 focus:outline-none font-bold text-lg placeholder-gray-700 transition">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-2 uppercase">Year</label>
                            <input type="text" id="filterYear" placeholder="2025"
                                class="w-full bg-[#13111c] border border-white/10 rounded-xl px-4 py-3 text-white focus:border-blue-500 focus:outline-none font-bold text-lg placeholder-gray-700 transition">
                        </div>
                    </div>

                    <!-- 3. Matched Styles (Problem List) -->
                    <div>
                        <!-- Search Action -->
                        <button onclick="filterProblems()"
                            class="w-full py-4 bg-[#1c1a26] border border-white/10 rounded-xl text-gray-400 font-bold hover:text-white hover:border-blue-500 hover:bg-blue-500/10 transition flex items-center justify-center gap-2 group mb-4">
                            <svg class="h-5 w-5 text-blue-500 group-hover:scale-110 transition" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            ë¬¸ì œìœ í˜• ì„ íƒ (ì¡°ê±´ ê²€ìƒ‰)
                        </button>

                        <div
                            class="flex-1 bg-[#13111c] border border-white/5 rounded-2xl p-4 min-h-[200px] max-h-[300px] overflow-y-auto custom-scrollbar">
                            <h4
                                class="text-blue-500 text-xs font-bold uppercase mb-4 sticky top-0 bg-[#13111c] py-2 z-10">
                                Matched Styles</h4>
                            <div id="problemList" class="space-y-2">
                                <div class="text-gray-600 text-center py-10 text-sm">í•„í„°ë¥¼ ì…ë ¥í•˜ê³  ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Dynamic Details (Assets & Context) -->
                    <!-- Automatically populated on selection -->
                    <div id="problemDetails" class="hidden grid grid-cols-2 gap-4 animation-fade-in">
                        <!-- Problem Asset -->
                        <div class="bg-[#13111c] border border-white/5 rounded-2xl p-4">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-gray-400">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                        </path>
                                    </svg>
                                </div>
                                <div>
                                    <h5 class="text-white font-bold text-xs">PROBLEM ASSETS</h5>
                                    <p class="text-[10px] text-gray-600">Cloud Reference</p>
                                </div>
                            </div>
                            <div class="bg-[#0a0a0c] border border-white/10 rounded-lg p-3 flex items-center gap-2">
                                <svg class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                                </svg>
                                <span id="detailProblemName" class="text-xs text-blue-400 truncate flex-1">ì˜¤ì „) ë¬¸ì œ
                                    (Cloud)</span>
                            </div>
                        </div>

                        <!-- Solution Key -->
                        <div class="bg-[#13111c] border border-white/5 rounded-2xl p-4">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-gray-400">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h5 class="text-white font-bold text-xs">SOLUTION KEYS</h5>
                                    <p class="text-[10px] text-gray-600">Grading Matrix</p>
                                </div>
                            </div>
                            <div class="bg-[#0a0a0c] border border-white/10 rounded-lg p-3 flex items-center gap-2">
                                <svg class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                                </svg>
                                <span id="detailSolutionName" class="text-xs text-blue-400 truncate flex-1">ì˜¤ì „) í•´ì„¤
                                    (Cloud)</span>
                            </div>
                        </div>

                        <!-- AI Context -->
                        <div class="col-span-2 bg-[#13111c] border border-white/5 rounded-2xl p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="text-[#888] font-bold text-xs uppercase">AI Scoring Context (Editable)</h5>
                                <button id="aiSearchBtn" disabled
                                    class="text-[10px] font-bold px-2 py-1 rounded bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 transition opacity-50 cursor-not-allowed">
                                    ğŸ” AI SEARCH
                                </button>
                            </div>
                            <textarea id="detailContext"
                                class="w-full bg-[#0a0a0c] border border-white/20 p-4 text-gray-400 text-xs font-mono leading-relaxed h-[100px] overflow-y-auto custom-scrollbar resize-none focus:outline-none focus:border-blue-500 rounded-lg"
                                placeholder="ìœ í˜• ì„ íƒ ì‹œ ê³µì‹ ì±„ì  ê¸°ì¤€ì´ ë¡œë“œë©ë‹ˆë‹¤. í•„ìš” ì‹œ ì§ì ‘ ìˆ˜ì •í•˜ê±°ë‚˜ ì…ë ¥í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>

                </div>

                <!-- Right Column: Student Management (5 cols) -->
                <div class="lg:col-span-5 flex flex-col h-full">

                    <div
                        class="bg-[#13111c] border border-white/5 rounded-2xl p-6 flex-1 flex flex-col relative overflow-hidden group">

                        <div class="flex items-center justify-between mb-6 z-10 relative">
                            <div>
                                <h3 class="text-white font-bold text-sm">STUDENT MANAGEMENT</h3>
                                <p class="text-xs text-gray-600">ìˆ˜ì§ ì´¬ì˜ & ê·¸ë¦¼ì ì œê±°</p>
                            </div>
                            <button onclick="toggleStudentInput()"
                                class="bg-blue-600/20 text-blue-500 hover:bg-blue-600/30 text-[10px] font-bold px-3 py-1.5 rounded-lg border border-blue-500/30 transition">+
                                ADD STUDENT</button>
                        </div>

                        <!-- Student Info Input -->
                        <div class="space-y-3 mb-4 z-10 relative">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">STUDENT NAME</label>
                                <input type="text" id="studentName" placeholder="ì˜ˆ: ì†¡ë¯¼ìˆ˜"
                                    class="w-full bg-[#0a0a0c] border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 focus:outline-none transition">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">EMAIL (Optional)</label>
                                <input type="email" id="studentEmail" placeholder="student@example.com"
                                    class="w-full bg-[#0a0a0c] border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 focus:outline-none transition">
                            </div>
                        </div>

                        <!-- Dropzone -->
                        <div class="flex-1 border-2 border-dashed border-white/5 rounded-xl relative hover:border-blue-500/30 transition group-hover:bg-[#151320] cursor-pointer z-10 min-h-[150px]"
                            onclick="document.getElementById('answerInput').click()">
                            <input type="file" id="answerInput" accept="image/*" multiple class="hidden"
                                onchange="handleAnswerUpload(this)">

                            <div id="answerPlaceholder"
                                class="absolute inset-0 flex flex-col items-center justify-center text-gray-600 group-hover:text-blue-500/50 transition duration-300">
                                <span class="text-3xl mb-2">+</span>
                                <span class="text-xs font-bold tracking-widest">ë‹µì•ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</span>
                            </div>

                            <div id="previewGrid"
                                class="absolute inset-0 p-4 grid grid-cols-2 gap-2 overflow-y-auto hidden custom-scrollbar bg-[#0a0a0c]/80 backdrop-blur-sm">
                            </div>
                        </div>

                        <!-- Main Action -->
                        <div class="mt-6 z-10">
                            <button id="mainActionBtn" onclick="startBatchAnalysis()"
                                class="w-full py-4 rounded-xl bg-[#1e1b2e] text-gray-600 font-bold text-sm border border-transparent transition-all cursor-not-allowed uppercase tracking-wider block"
                                disabled>
                                START BATCH ANALYSIS
                            </button>
                        </div>

                        <!-- Report Section (Initially Hidden) -->
                        <div id="reportSection" class="mt-12 pt-12 border-t border-white/10 hidden">
                            <!-- Report Header -->
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h2 class="text-2xl font-bold text-white mb-1">AI í‰ê°€ ë³´ê³ ì„œ</h2>
                                    <p id="reportContext" class="text-xs text-gray-500">2025í•™ë…„ë„ ì•„ì£¼ëŒ€í•™êµ (Math)</p>
                                </div>
                                <button onclick="closeReport()"
                                    class="px-4 py-2 bg-white/5 hover:bg-white/10 rounded text-xs text-gray-400 transition">
                                    ì ‘ê¸° (Hide)
                                </button>
                            </div>

                            <!-- Report Body Holder -->
                            <div id="reportBody" class="min-h-[400px]">
                                <!-- AI Content will be injected here -->
                            </div>
                        </div>

                        <!-- BG Decoration -->
                        <div
                            class="absolute -bottom-20 -right-20 w-60 h-60 bg-blue-500/5 rounded-full blur-3xl pointer-events-none group-hover:bg-blue-500/10 transition duration-700">
                        </div>
                    </div>

                </div>
            </div>

            <!-- Progress Overlay (Same as before) -->
            <div id="progressOverlay"
                class="absolute inset-0 bg-black/90 backdrop-blur-md z-50 flex flex-col items-center justify-center hidden">
                <div class="w-full max-w-lg p-8 relative">
                    <!-- Progress Card -->
                    <div class="bg-[#13111c] border border-blue-500/20 rounded-2xl p-6 shadow-2xl">
                        <div class="flex items-center justify-between text-white mb-4">
                            <span class="font-bold flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                                AI Analysis In Progress
                            </span>
                            <span id="progressPercent" class="text-blue-500 font-mono">0%</span>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-1.5 mb-8 overflow-hidden">
                            <div id="progressBar"
                                class="bg-gradient-to-r from-blue-600 to-cyan-400 h-full rounded-full transition-all duration-300 relative"
                                style="width: 0%">
                                <div class="absolute inset-0 bg-white/20 animate-[shimmer_2s_infinite]"></div>
                            </div>
                        </div>

                        <div class="space-y-4 font-mono text-sm">
                            <div id="taskFormula"
                                class="flex items-center gap-4 text-gray-600 transition-colors duration-300">
                                <div
                                    class="w-4 h-4 rounded border border-current flex items-center justify-center text-[10px]">
                                    1</div>
                                <span>ìˆ˜ì‹ ê²€ì¦ (Formula Check)</span>
                            </div>
                            <div id="taskLogic"
                                class="flex items-center gap-4 text-gray-600 transition-colors duration-300">
                                <div
                                    class="w-4 h-4 rounded border border-current flex items-center justify-center text-[10px]">
                                    2</div>
                                <span>ë…¼ë¦¬ ì§„ë‹¨ (Logic Flow)</span>
                            </div>
                            <div id="taskFeedback"
                                class="flex items-center gap-4 text-gray-600 transition-colors duration-300">
                                <div
                                    class="w-4 h-4 rounded border border-current flex items-center justify-center text-[10px]">
                                    3</div>
                                <span>í”¼ë“œë°± ìƒì„± (Generating Feedback)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Result Card (Pop up) -->
                    <div id="resultArea" class="mt-4 hidden animation-slide-up">
                        <div
                            class="p-6 bg-[#0a0a0c] rounded-2xl border border-green-500/30 text-gray-300 text-sm max-h-[300px] overflow-y-auto custom-scrollbar shadow-2xl relative">
                            <div
                                class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-green-500 to-emerald-500">
                            </div>
                            <div id="resultText" class="leading-relaxed whitespace-pre-wrap"></div>
                        </div>
                        <button onclick="closeProgress()"
                            class="w-full mt-4 py-4 bg-[#1c1a26] hover:bg-white/10 border border-white/10 text-white rounded-xl font-bold transition uppercase tracking-widest">
                            í™•ì¸ ì™„ë£Œ (CLOSE)
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Report Modal (Full Screen) -->










    </div>
    </div>

    <script>
        window.onerror = function (msg, url, line, col, error) {
            console.error("Global Error:", msg, url, line);
            // alert("System Error: " + msg); // Optional for user visibility
        };

        // --- GLOBAL UI VARIABLES ---
        window.problemsData = [];
        window.currentProblemId = null;
        window.selectedFiles = [];

        // --- ROBUST UI FUNCTIONS (Non-Module) ---

        window.toggleStudentInput = function () {
            document.getElementById('studentName').value = '';
            document.getElementById('studentEmail').value = '';
            document.getElementById('studentName').focus();
            const btn = event.currentTarget;
            if (btn) {
                const originalText = btn.innerText;
                btn.innerText = "READY!";
                setTimeout(() => btn.innerText = originalText, 1000);
            }
        };

        window.handleAnswerUpload = function (input) {
            if (input.files) {
                const grid = document.getElementById('previewGrid');
                const placeholder = document.getElementById('answerPlaceholder');
                window.selectedFiles = Array.from(input.files);

                if (window.selectedFiles.length > 0) {
                    placeholder.classList.add('hidden');
                    grid.classList.remove('hidden');
                    grid.innerHTML = '';
                    window.selectedFiles.forEach((file, idx) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = "w-full h-32 object-cover rounded-lg border border-white/10";
                            grid.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    });
                    const btn = document.getElementById('mainActionBtn');
                    btn.disabled = false;
                    btn.classList.remove('cursor-not-allowed', 'text-gray-600');
                    btn.classList.add('hover:bg-blue-600', 'text-white', 'cursor-pointer', 'bg-blue-500');
                    btn.innerText = `START BATCH ANALYSIS (${window.selectedFiles.length})`;
                }
            }
        };

        window.openGradingModal = async function () {
            const modal = document.getElementById('gradingModal');
            if (modal) {
                modal.classList.remove('hidden');
            }

            const studentInput = document.getElementById('studentName');
            if (studentInput && !studentInput.value) {
                studentInput.value = "ë¯¸ë˜ì˜ í•©ê²©ìƒ (Guest)";
            }

            await window.fetchProblems();
        };

        window.closeGradingModal = function () {
            document.getElementById('gradingModal').classList.add('hidden');
        };

        window.fetchProblems = async function (file = null) {
            if (file) {
                // Forward to handleCSV for consistency if needed, or parse directly
                // For now, simple file read:
                const reader = new FileReader();
                reader.onload = (e) => {
                    window.parseCSV(e.target.result);
                    window.filterProblems();
                };
                reader.readAsText(file, 'UTF-8');
                return;
            }

            try {
                const response = await fetch('/sampleProbs.csv');
                if (!response.ok) throw new Error("Failed to load sample CSV");
                const text = await response.text();
                window.parseCSV(text);
                window.filterProblems();
            } catch (e) {
                console.error("CSV Error:", e);
                document.getElementById('problemList').innerHTML = `<div class="text-red-500 text-center">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>`;
            }
        };

        window.parseCSV = function (text) {
            if (!text || text.trim() === '') return;
            const rows = [];
            let currentRow = [];
            let currentVal = '';
            let insideQuotes = false;
            text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];
                if (char === '"') {
                    if (insideQuotes && nextChar === '"') { currentVal += '"'; i++; }
                    else { insideQuotes = !insideQuotes; }
                } else if (char === ',' && !insideQuotes) {
                    currentRow.push(currentVal); currentVal = '';
                } else if (char === '\n' && !insideQuotes) {
                    currentRow.push(currentVal);
                    if (currentRow.length > 0) rows.push(currentRow);
                    currentRow = []; currentVal = '';
                } else { currentVal += char; }
            }
            if (currentVal || currentRow.length > 0) { currentRow.push(currentVal); rows.push(currentRow); }

            if (rows.length < 2) return;
            const headers = rows[0].map(h => h.trim().toLowerCase());
            const findIndex = (keywords) => headers.findIndex(h => keywords.some(k => h.includes(k)));

            const idxId = findIndex(['id', 'ë²ˆí˜¸']);
            const idxUnivName = findIndex(['ëŒ€í•™êµ ì´ë¦„', 'university', 'univ']);
            const idxYearCol = findIndex(['ì¶œì œ ë…„ë„', 'year']);
            const idxProbType = findIndex(['ë¬¸ì œ ìœ í˜•', 'question', 'subject']);
            const idxProbUrl = findIndex(['ë¬¸ì œ url', 'url', 'link']);
            const idxSolUrl = findIndex(['í’€ì´ url', 'solution']);
            const idxCrit = findIndex(['criteria', 'standard', 'ê¸°ì¤€']);

            window.problemsData = rows.slice(1).map((cols, i) => {
                if (cols.length < 2) return null;
                const getCol = (idx) => idx > -1 ? cols[idx] : "";

                // Generic Criteria Fallback
                const genericCriteria = `[AI ìˆ˜ë¦¬ë…¼ìˆ  í‘œì¤€ ì±„ì  ê¸°ì¤€]
1. ë¬¸ì œ ì´í•´ (20ì )
- ì œì‹œë¬¸ì˜ í•µì‹¬ ì›ë¦¬ íŒŒì•… ì—¬ë¶€
- ë¬¸ì œì—ì„œ ìš”êµ¬í•˜ëŠ” ì¡°ê±´ë“¤ì„ ëˆ„ë½ ì—†ì´ í™•ì¸í–ˆëŠ”ê°€

2. ë…¼ë¦¬ì  ì„œìˆ  (40ì )
- ë„ì…-ì „ê°œ-ê²°ë¡ ì˜ êµ¬ì¡°ì  ì™„ê²°ì„± (Start-to-End Logic)
- ìˆ˜ì‹ ì „ê°œ ê³¼ì •ì˜ ë¹„ì•½ ì—¬ë¶€ (Since/Because ëª…ì‹œ)
- í•µì‹¬ í‚¤ì›Œë“œ ë° ì •ë¦¬ê°€ ì ì ˆíˆ ì¸ìš©ë˜ì—ˆëŠ”ê°€

3. ê³„ì‚° ë° ê²°ê³¼ (30ì )
- ìˆ˜ì‹ ê³„ì‚°ì˜ ì •í™•ì„±
- ìµœì¢… ë‹µì•ˆì˜ ë‹¨ìœ„ ë° í˜•íƒœ ì˜¤ë¥˜ ì—¬ë¶€

4. ê°€ë…ì„± (10ì )
- ê¸€ì”¨ ë° ìˆ˜ì‹ì˜ ì •ëˆ ìƒíƒœ`;

                let crit = getCol(idxCrit);
                if (!crit) crit = genericCriteria;

                return {
                    id: getCol(idxId) || `Q${String(i + 1).padStart(3, '0')}`,
                    university: getCol(idxUnivName) || 'Unknown',
                    year: getCol(idxYearCol) || '2025',
                    subject: "ìˆ˜ë¦¬ë…¼ìˆ ", // Hardcoded for sample
                    question: getCol(idxProbType) || "ë…¼ìˆ  ë¬¸ì œ",
                    criteria: crit,
                    model_answer: "",
                    problem_url: getCol(idxProbUrl),
                    solution_url: getCol(idxSolUrl),
                    raw: cols.join(',')
                };
            }).filter(p => p && p.university !== "Unknown");

            // Sort
            window.problemsData.sort((a, b) => a.university.localeCompare(b.university) || a.year.localeCompare(b.year));
            const countEl = document.getElementById('recordCount');
            if (countEl) countEl.innerText = `${window.problemsData.length} RECORDS`;
        };

        window.filterProblems = function () {
            const univ = document.getElementById('filterUniversity').value.toLowerCase();
            const year = document.getElementById('filterYear').value;
            let filtered = window.problemsData.filter(p => {
                const matchUniv = !univ || p.university.toLowerCase().includes(univ);
                const matchYear = !year || p.year.includes(year);
                return matchUniv && matchYear;
            });
            window.renderProblems(filtered);
        };

        window.renderProblems = function (items) {
            const list = document.getElementById('problemList');
            list.innerHTML = '';
            if (items.length === 0) {
                list.innerHTML = '<div class="text-gray-600 text-center py-10 text-sm">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            items.forEach(p => {
                const div = document.createElement('div');
                div.className = "group bg-[#0a0a0c] border border-white/5 rounded-xl p-4 hover:border-blue-500/50 hover:bg-blue-500/5 transition cursor-pointer flex items-center justify-between";
                div.innerHTML = `
                    <div class="flex-1 truncate">
                         <div class="flex items-center gap-2 mb-1">
                              <span class="text-blue-500 text-[10px] font-bold px-2 py-0.5 bg-blue-500/10 rounded border border-blue-500/20">${p.year}</span>
                              <span class="text-gray-400 text-xs font-bold">${p.university}</span>
                         </div>
                         <div class="text-gray-300 text-sm truncate pr-4">${p.question.substring(0, 60)}...</div>
                    </div>
                    <div class="text-gray-600 group-hover:text-blue-500 transition">â–¶</div>
                 `;
                div.onclick = () => window.selectProblem(p);
                list.appendChild(div);
            });
        };

        window.selectProblem = function (p) {
            window.currentProblemId = p.id;
            document.getElementById('problemDetails').classList.remove('hidden');
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (el) el.innerText = text;
            };

            setText('detailTitle', p.question);
            setText('detailUnivMatch', `${p.university} ${p.year}`);

            // Update Asset Links
            const probLink = document.getElementById('problemLink');
            const solLink = document.getElementById('solutionLink');
            if (probLink) {
                probLink.href = p.problem_url || "#";
                probLink.innerHTML = p.problem_url ? `<span class="text-blue-400 hover:text-blue-300">ğŸ”— ë¬¸ì œ ë³´ê¸° (PDF)</span>` : `<span class="text-gray-600">ë¬¸ì œ íŒŒì¼ ì—†ìŒ</span>`;
                probLink.target = "_blank";
            }
            if (solLink) {
                solLink.href = p.solution_url || "#";
                solLink.innerHTML = p.solution_url ? `<span class="text-blue-400 hover:text-blue-300">ğŸ”— í•´ì„¤ ë³´ê¸° (PDF)</span>` : `<span class="text-gray-600">í•´ì„¤ íŒŒì¼ ì—†ìŒ</span>`;
                solLink.target = "_blank";
            }

            // Update Search Button State
            const searchBtn = document.getElementById('aiSearchBtn');
            if (searchBtn) {
                // p.university and p.year are already available here
                searchBtn.onclick = () => window.searchContext(p.university, p.year, p.subject);
                searchBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                searchBtn.disabled = false;
            }

            window.simulateContextSearch(p);
        };

        window.searchContext = async function (univ, year, type) {
            const contextArea = document.getElementById('detailContext');
            const btn = document.getElementById('aiSearchBtn');

            if (!univ) { alert("ëŒ€í•™êµ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

            // UI Feedback
            btn.innerText = "SEARCHING...";
            btn.classList.add('animate-pulse');
            contextArea.value = `Searching web for '${univ} ${year} Grading Context'...`;

            try {
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                const API_URL = isLocal ? 'https://searchscoringcriteria-qm5h7q6meq-uc.a.run.app' : '/searchScoringCriteria';

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ university: univ, year: year, problemType: type })
                });

                if (!response.ok) throw new Error("Search Failed");
                const data = await response.json();

                contextArea.value = data.text || "No criteria found.";

            } catch (e) {
                console.error(e);
                alert("ê²€ìƒ‰ ì‹¤íŒ¨: " + e.message);
                contextArea.value = "ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            } finally {
                btn.innerText = "ğŸ” AI SEARCH";
                btn.classList.remove('animate-pulse');
            }
        };

        window.simulateContextSearch = async function (p) {
            const contextArea = document.getElementById('detailContext');
            contextArea.value = `Searching web for '${p.university} ${p.year} Grading Context'...`;
            contextArea.classList.add('animate-pulse', 'text-blue-400');
            await new Promise(resolve => setTimeout(resolve, 1500));
            contextArea.classList.remove('animate-pulse', 'text-blue-400');
            contextArea.value = p.criteria || "ê¸°ë³¸ ì±„ì  ê¸°ì¤€";
        };

        // Placeholder for API function (Module will override this)
        window.submitAnswerToAPI = async function () {
            alert("AI ì„œë²„ ì—°ê²° ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. (Initializing...)");
        };

        window.startBatchAnalysis = function () {
            if (!window.currentProblemId) { alert("ë¬¸ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
            if (!window.selectedFiles.length) { alert("ë‹µì•ˆì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”."); return; }
            window.submitAnswerToAPI(window.currentProblemId, window.selectedFiles[0]);
        };

        window.showReport = function (resultData) {
            const section = document.getElementById('reportSection');
            section.classList.remove('hidden');

            const reportBody = document.getElementById('reportBody');

            // CHECK: 3-Step Pipeline Result (Premium HTML)
            if (resultData && resultData.html_report) {
                reportBody.innerHTML = resultData.html_report;
            } else {
                console.warn("HTML Report missing, using fallback. Result Data:", resultData);

                // Fallback Logic (Safe injection)
                const score = resultData?.score || 0;

                // Handle object-based feedback (fix [object Object])
                let feedbackText = "ê²°ê³¼ í™•ì¸";
                if (resultData?.feedback) {
                    if (typeof resultData.feedback === 'string') feedbackText = resultData.feedback;
                    else if (resultData.feedback.text) feedbackText = resultData.feedback.text;
                    else feedbackText = JSON.stringify(resultData.feedback, null, 2);
                }

                reportBody.innerHTML = `
                    <div class="p-8 text-center text-gray-400">
                        <h3 class="text-xl font-bold mb-2 text-white">ë¶„ì„ ì™„ë£Œ (Analysis Complete)</h3>
                        <div class="text-4xl font-bold text-blue-400 my-4">${score} / 100</div>
                        <p class="whitespace-pre-wrap text-left bg-black/30 p-4 rounded-lg font-mono text-xs">${feedbackText}</p>
                        <p class="mt-4 text-red-400 text-xs">âš ï¸ Premium Report Generation Failed. Check Console for details.</p>
                    </div>`;
            }

            // Scroll to the Report Section with animation
            setTimeout(() => {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        };

        window.closeReport = function () {
            document.getElementById('reportSection').classList.add('hidden');
            // Scroll back to main action
            document.getElementById('mainActionBtn').scrollIntoView({ behavior: 'smooth', block: 'center' });
        };

    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB0bOxRGkg2DDbz5dTX-Mv2DE1vLbvGC7k",
            authDomain: "questio-2dd69.firebaseapp.com",
            projectId: "questio-2dd69",
            storageBucket: "questio-2dd69.firebasestorage.app",
            messagingSenderId: "738461414990",
            appId: "1:738461414990:web:baa3d65c8469be6c90351f",
            measurementId: "G-TPRBFKQGG6"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.submitAnswerToAPI = async function (problemId, file) {
            document.getElementById('progressOverlay').classList.remove('hidden');
            const setProgress = (n, id) => {
                document.getElementById('progressBar').style.width = n + '%';
                document.getElementById('progressPercent').innerText = n + '%';
                if (id) {
                    const el = document.getElementById(id);
                    if (el) {
                        el.className = 'flex items-center gap-4 text-blue-400 animate-pulse';
                        el.children[0].className = 'w-4 h-4 rounded border border-blue-500 bg-blue-500 text-white flex items-center justify-center text-[10px]';
                    }
                }
            };
            setProgress(5, null);
            document.getElementById('resultArea').classList.add('hidden');

            // Reset task indicators
            ['taskFormula', 'taskLogic', 'taskFeedback'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.className = 'flex items-center gap-4 text-gray-600';
                    el.children[0].className = 'w-4 h-4 rounded border border-current flex items-center justify-center text-[10px]';
                }
            });

            try {
                const toBase64 = file => new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });

                const imageBase64 = await toBase64(file);
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                const API_URL = isLocal ? 'https://submitanswer-qm5h7q6meq-uc.a.run.app' : '/submitAnswer';

                const studentName = document.getElementById('studentName').value || "Guest Student";
                const criteriaText = document.getElementById('detailContext').value;

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: studentName, imageUrl: imageBase64, problemId: problemId, criteria: criteriaText })
                });

                if (!response.ok) throw new Error('Network error');
                const data = await response.json();
                const ticketId = data.ticketId;

                const unsub = onSnapshot(doc(db, "grading_tickets", ticketId), (docSnap) => {
                    const d = docSnap.data();
                    if (!d) return;

                    let completedCount = 0;
                    ['formula', 'logic', 'feedback'].forEach((task) => {
                        const taskId = 'task' + task.charAt(0).toUpperCase() + task.slice(1);
                        if (d.tasks && d.tasks[task]) {
                            const status = d.tasks[task].status;
                            if (status === 'processing') {
                                // setProgress update handled by general progress bar, but we can highlight current task
                                const el = document.getElementById(taskId);
                                if (el && el.className.includes('text-gray-600')) {
                                    el.className = 'flex items-center gap-4 text-blue-400 animate-pulse';
                                    el.children[0].className = 'w-4 h-4 rounded border border-blue-500 bg-blue-500 text-white flex items-center justify-center text-[10px]';
                                }
                            } else if (status === 'completed') {
                                completedCount++;
                                const el = document.getElementById(taskId);
                                if (el) {
                                    el.className = 'flex items-center gap-4 text-green-400';
                                    el.children[0].className = 'w-4 h-4 rounded border border-green-500 bg-green-500 text-white flex items-center justify-center text-[10px]';
                                }
                            }
                        }
                    });

                    const pct = 10 + (completedCount * 30);
                    document.getElementById('progressBar').style.width = pct + '%';
                    document.getElementById('progressPercent').innerText = pct + '%';

                    if (d.status === 'completed') {
                        document.getElementById('progressOverlay').classList.add('hidden');
                        if (window.showReport) window.showReport(d.result);
                        unsub();
                    }
                });

            } catch (error) {
                console.error("Analysis Error:", error);
                alert("ë¶„ì„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
                document.getElementById('progressOverlay').classList.add('hidden');
            }
        };
    </script>
</body>

</html>